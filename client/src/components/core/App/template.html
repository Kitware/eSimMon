<v-app class="app">
  <v-dialog :value="loggedOut" persistent max-width="600px">
    <girder-authentication
      :register="true"
      :oauth="false"
      :forgot-password-url="forgotPasswordUrl"
    />
  </v-dialog>
  <context-menu />
  <splitpanes @resize="adjustRenderWindowWidth">
    <pane min-size="15" :size="25">
      <v-row v-bind:style="{height: '100vh'}">
        <!-- Navigation panel on the left. -->
        <v-col v-bind:style="{padding: '0 10px'}">
          <!-- Girder data table browser. -->
          <div class="girder-placeholder" v-if="!location" />
          <div>
            <v-tooltip
              right
              light
              v-if="range"
              :value="range"
              :position-x="pos[0]"
              :position-y="pos[1]"
            >
              <span v-if="range">{{range}}</span>
            </v-tooltip>
          </div>
          <girder-file-manager
            ref="girderFileManager"
            v-if="location"
            v-on:mouseover.native="hoverIn($event)"
            v-on:mouseout.native="hoverOut"
            :location.sync="location"
            :selectable="false"
            :drag-enabled="true"
          />
          <!-- Playback controls. -->
          <v-container
            :fluid="true"
            class="playback-controls"
            v-on:mouseover="hoverOut"
          >
            <v-row>
              <v-col :sm="1" class="text-xs-center">
                <v-icon
                  v-on:click="decrementTimeStep(true)"
                  :disabled="!dataLoaded || currentTimeStep === minTimeStep"
                >
                  arrow_back_ios
                </v-icon>
              </v-col>
              <v-col :sm="10">
                <v-slider
                  :min="minTimeStep"
                  :max="maxTimeStep"
                  :disabled="!dataLoaded"
                  height="1px"
                  :value="sliderValue"
                  @change="updateTimeStep"
                />
              </v-col>
              <v-col :sm="1" class="text-xs-center">
                <v-icon
                  v-on:click="incrementTimeStep(true)"
                  :disabled="!dataLoaded || currentTimeStep === maxTimeStep"
                >
                  arrow_forward_ios
                </v-icon>
              </v-col>
            </v-row>
            <v-row v-bind:style="{alignItems: 'baseline'}">
              <v-col :sm="6" class="text-xs-center">
                <v-icon
                  v-show="paused"
                  v-on:click="togglePlayPause"
                  :disabled="!dataLoaded"
                >
                  &#9654;
                </v-icon>
                <v-icon
                  v-show="!paused"
                  v-on:click="togglePlayPause"
                  :disabled="!dataLoaded"
                >
                  &#9208;
                </v-icon>
              </v-col>
              <v-col :sm="6" class="text-xs-center">
                <input
                  type="number"
                  min="minTimeStep"
                  :max="maxTimeStep"
                  size="4"
                  :disabled="!dataLoaded"
                  :value="currentTimeStep"
                  @change="(e) => {updateTimeStep(e.target.value)}"
                />
              </v-col>
            </v-row>
            <v-row v-bind:style="{alignItems: 'center', paddingTop: '10px'}">
              <v-col :sm="2">
                <v-icon v-on:click="removeRow()" :disabled="numrows < 2">
                  remove_circle_outline
                </v-icon>
              </v-col>
              <v-col :sm="2">
                <span> rows </span>
              </v-col>
              <v-col :sm="2">
                <v-icon v-on:click="addRow()" :disabled="numrows > 7">
                  add_circle_outline
                </v-icon>
              </v-col>
              <v-col :sm="2">
                <v-icon v-on:click="removeColumn()" :disabled="numcols < 2">
                  remove_circle_outline
                </v-icon>
              </v-col>
              <v-col :sm="2">
                <span> cols </span>
              </v-col>
              <v-col :sm="2">
                <v-icon v-on:click="addColumn()" :disabled="numcols > 7">
                  add_circle_outline
                </v-icon>
              </v-col>
            </v-row>
            <view-controls :plots.sync="$refs.plots" />
          </v-container>
        </v-col>
      </v-row>
    </pane>
    <!-- Scientific data on the right. -->
    <pane
      id="mainContent"
      min-size="50"
      :size="85"
      class="main-content"
      v-on:mouseover.native="hoverOut"
    >
      <!-- image gallery grid. -->
      <render-window ref="renderWindow" id="renderWindow" class="plots" />
      <v-container v-bind:style="{padding: '0', maxWidth: '100%'}">
        <template v-for="i in numrows">
          <v-row v-bind:key="i">
            <template v-for="j in numcols">
              <v-col
                v-bind:key="j"
                v-bind:style="{ width: cellWidth, height: cellHeight, padding: '0' }"
              >
                <plots
                  ref="plots"
                  v-bind:style="{padding: '0 0 0 3px', height: 'inherit'}"
                  v-bind:class="[paused ? 'show-toolbar' : 'hide-toolbar']"
                  v-bind:row="i"
                  v-bind:col="j"
                />
              </v-col>
            </template>
          </v-row>
        </template>
      </v-container>
    </pane>
  </splitpanes>
  <v-dialog v-model="autoSavedViewDialog" persistent max-width="300">
    <v-card>
      <v-card-title class="headline">Load auto-saved view?</v-card-title>
      <v-card-text
        >An auto-saved view has been found for this run. Would you like to load
        it now?</v-card-text
      >
      <v-card-actions>
        <v-spacer></v-spacer>
        <v-btn text @click.stop="setAutoSavedViewDialog(false)">Cancel</v-btn>
        <v-btn text @click.stop="loadAutoSavedView">Load View</v-btn>
      </v-card-actions>
    </v-card>
  </v-dialog>
</v-app>
